!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).useeio={})}(this,(function(t){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}"function"==typeof SuppressedError&&SuppressedError;var o,s=function(){function t(t){this.data=t,this.rows=t.length,this.cols=0===this.rows?0:t[0].length}return t.zeros=function(e,n){for(var r=new Array(e),i=0;i<e;i++){for(var o=new Array(n),s=0;s<n;s++)o[s]=0;r[i]=o}return new t(r)},t.prototype.get=function(t,e){return this.data[t][e]},t.prototype.getRow=function(t){return this.data[t].slice()},t.prototype.getCol=function(t){for(var e=new Array(this.rows),n=0;n<this.rows;n++)e[n]=this.get(n,t);return e},t.prototype.set=function(t,e,n){this.data[t][e]=n},t.prototype.scaleColumns=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[i];n.set(r,i,o)}return n},t.prototype.scaleRows=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[r];n.set(r,i,o)}return n},t.prototype.multiplyVector=function(t){return this.data.map((function(e){return e.reduce((function(e,n,r){var i=t[r];return n&&i?e+n*i:e}),0)}))},t}();t.IndicatorGroup=void 0,(o=t.IndicatorGroup||(t.IndicatorGroup={})).IMPACT_POTENTIAL="Impact Potential",o.RESOURCE_USE="Resource Use",o.WASTE_GENERATED="Waste Generated",o.ECONOMIC_SOCIAL="Economic & Social",o.CHEMICAL_RELEASES="Chemical Releases";var a,c,u=function(){function t(t){if(this.map={},t)for(var e=0,n=t;e<n.length;e++){var r=n[e];this.map[r.sector]=r.amount}}return t.prototype.get=function(t){var e=this.map[t];return e||0},t}();function l(t){return new Array(t).fill(0)}t.Tensor=void 0,(a=t.Tensor||(t.Tensor={})).A="A",a.A_d="A_d",a.B="B",a.C="C",a.D="D",a.L="L",a.L_d="L_d",a.M="M",a.M_d="M_d",a.N="N",a.N_d="N_d",a.Phi="Phi",a.q="q",a.Rho="Rho",a.U="U",a.U_d="U_d",a.V="V",a.x="x",t.Region=void 0,(c=t.Region||(t.Region={})).DOMESTIC="DOMESTIC",c.NON_DOMESTIC="NON_DOMESTIC",c.ALL="ALL";var h=function(){function e(){}return e.directImpactsOf=function(e,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=n instanceof s?n.getCol(0):n,[4,e.matrix(t.Tensor.D)];case 1:return[2,i.sent().multiplyVector(r)]}}))}))},e.directRequirementsOf=function(e,n){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return r=n instanceof s?n.getCol(0):n,[4,e.matrix(t.Tensor.A)];case 1:return[2,i.sent().multiplyVector(r)]}}))}))},e.directDownstreamsOf=function(e,n){return r(this,void 0,void 0,(function(){var r,o,a,c,u,h,f,d;return i(this,(function(i){switch(i.label){case 0:return r=n instanceof s?n.getCol(0):n,[4,e.matrix(t.Tensor.A)];case 1:for(o=i.sent(),a=Math.min(o.cols,r.length),c=l(a),u=0,h=o.data;u<h.length;u++)for(f=h[u],d=0;d<a;d++)c[d]+=f[d]*r[d];return[2,c]}}))}))},e}(),f=function(){function t(t){this._map=t}return t.of=function(e){var n;return r(this,void 0,void 0,(function(){var r,o,s,a,c,u,l,h,f,d,p,v,m,g,y;return i(this,(function(i){switch(i.label){case 0:return[4,e.sectorCrosswalk()];case 1:return(r=i.sent())&&r.header&&0!==r.header.length&&r.mappings&&0!==r.mappings.length?[4,e.info()]:[2,new t({})];case 2:for(o=i.sent(),s=null===(n=null==o?void 0:o.sectorschema)||void 0===n?void 0:n.toLowerCase(),a=-1,c=-1,u=0;u<r.header.length&&!(a>=0&&c>=0);u++)"naics"!==(l=r.header[u].toLowerCase())?(s&&l==s||!c&&l.includes("bea")&&l.includes("detail"))&&(c=u):a=u;if(a<0||c<0)return[2,new t({})];for(h={},f=Math.max(a,c)+1,d=0,p=r.mappings;d<p.length;d++)(v=p[d]).length<f||(m=v[a].trim(),g=v[c].trim(),0!=m.length&&0!=g.length&&((y=h[m])?y.push(g):h[m]=[g]));return[2,new t(h)]}}))}))},t.prototype.toBea=function(t){if(!t)return[];for(var e={},n=0,r=t instanceof Array?t:[t];n<r.length;n++){var i=r[n],o=this._map[i];if(o)for(var s=0,a=o;s<a.length;s++){e[a[s]]=!0}}return Object.keys(e)},t}();var d=function(){function t(t){if(this._config=t,!t||!t.endpoint)throw new Error("invalid endpoint");var e=t.endpoint;e.endsWith("/")||(e+="/"),this._endpoint=e}return t.prototype.isJsonDump=function(){return!0===this._config.asJsonFiles},t.prototype.getModelInfos=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.getJson("models")]}))}))},t.prototype.getJson=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=this._target.apply(this,t),this._config.asJsonFiles&&(e.endsWith(".json")||(e+=".json")),n=this._request("GET",e),[2,new Promise((function(t,r){n.onload=function(){if(200===n.status)try{var i=JSON.parse(n.responseText);t(i)}catch(t){r("failed to parse response for: "+e+": "+t)}else r("request ".concat(e," failed: ").concat(n.statusText))},n.send()}))]}))}))},t.prototype.getText=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=this._target.apply(this,t),n=this._request("GET",e),[2,new Promise((function(t,r){n.onload=function(){if(200===n.status)try{t(n.responseText)}catch(t){r("failed to parse response for: "+e+": "+t)}else r("request ".concat(e," failed: ").concat(n.statusText))},n.send()}))]}))}))},t.prototype.post=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){return n=this._target.apply(this,e),r=this._request("POST",n),[2,new Promise((function(e,i){r.onload=function(){if(200===r.status)try{var t=JSON.parse(r.responseText);e(t)}catch(t){i("failed to parse response for POST "+n+": "+t)}else i("request POST ".concat(n," failed: ").concat(r.statusText))},r.send(JSON.stringify(t))}))]}))}))},t.prototype._target=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!t)return this._endpoint;for(var n=this._endpoint,r=0,i=t;r<i.length;r++){var o=i[r];o&&(n.endsWith("/")||(n+="/"),n+=o)}return n},t.prototype._request=function(t,e){var n=new XMLHttpRequest;return n.open(t,e),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this._config.apikey&&n.setRequestHeader("x-api-key",this._config.apikey),n},t}(),p=function(){function e(t,e){this.api=t,this.modelId=e,this._matrices={},this._demands={},this._totalResults={}}return e.prototype.id=function(){return this.modelId},e.prototype.info=function(){return r(this,void 0,void 0,(function(){var t,e,n,r;return i(this,(function(i){switch(i.label){case 0:return this._info?[3,2]:[4,this.api.getModelInfos()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)if((r=n[e]).id==this.id()){this._info=r;break}i.label=2;case 2:return[2,this._info]}}))}))},e.prototype.sectors=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._sectors?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"sectors")]);case 1:t._sectors=e.sent(),e.label=2;case 2:return[2,this._sectors||[]]}}))}))},e.prototype.isMultiRegional=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return"boolean"==typeof this._isMultiRegional?[2,this._isMultiRegional]:[4,this.sectors()];case 1:for(t=i.sent(),n=0,r=t;n<r.length;n++)if((o=r[n]).location)if(e){if(e!==o.location)return this._isMultiRegional=!0,[2,!0]}else e=o.location;return this._isMultiRegional=!1,[2,!1]}}))}))},e.prototype.indicators=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._indicators?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"indicators")]);case 1:t._indicators=e.sent(),e.label=2;case 2:return[2,this._indicators||[]]}}))}))},e.prototype.demands=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._demandInfos?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"demands")]);case 1:t._demandInfos=e.sent(),e.label=2;case 2:return[2,this._demandInfos||[]]}}))}))},e.prototype.demand=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=this._demands[t])?[2,e]:[4,this.api.getJson(this.modelId,"demands",t)];case 1:return e=n.sent(),this._demands[t]=e,[2,e]}}))}))},e.prototype.findDemand=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.demands()];case 1:return e=r.sent(),[2,(n=e.find((function(e){return(!t.id||e.id===t.id)&&((!t.type||e.type===t.type)&&((!t.system||e.system===t.system)&&!(t.year&&e.year!==t.year)))})))?n.id:null]}}))}))},e.prototype.matrix=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return(e=this._matrices[t])?[2,e]:[4,this.api.getJson(this.modelId,"matrix",t)];case 1:return n=r.sent(),e=new s(n),this._matrices[t]=e,[2,e]}}))}))},e.prototype.column=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=this._matrices[t])?[2,n.getCol(e)]:this.api.isJsonDump()?[4,this.matrix(t)]:[2,this.api.getJson(this.modelId,"matrix","".concat(t,"?col=").concat(e))];case 1:return[2,(n=r.sent()).getCol(e)]}}))}))},e.prototype.row=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=this._matrices[t])?[2,n.getRow(e)]:this.api.isJsonDump()?[4,this.matrix(t)]:[2,this.api.getJson(this.modelId,"matrix","".concat(t,"?row=").concat(e))];case 1:return[2,(n=r.sent()).getRow(e)]}}))}))},e.prototype.calculate=function(e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,l,h;return i(this,(function(i){switch(i.label){case 0:return this.api.isJsonDump()?[4,this.indicators()]:[2,this.api.post(e,this.modelId,"calculate")];case 1:return n=i.sent(),[4,this.sectors()];case 2:return r=i.sent(),o=new Array(r.length).fill(10),s={},r.reduce((function(t,e){return t[e.id]=e.index,t}),s),e.demand.forEach((function(t){var e=s[t.sector];(0===e||e)&&(o[e]=t.amount)})),[4,this.matrix(t.Tensor.N)];case 3:switch(a=i.sent(),e.perspective){case"direct":return[3,4];case"intermediate":return[3,7];case"final":return[3,9]}return[3,10];case 4:case 7:return[4,this.matrix(t.Tensor.L)];case 5:return u=i.sent(),h=u.multiplyVector(o),[4,this.matrix(t.Tensor.D)];case 6:return l=i.sent(),c=l.scaleColumns(h).data,[3,11];case 8:return u=i.sent(),h=u.multiplyVector(o),c=a.scaleColumns(h).data,[3,11];case 9:return c=a.scaleColumns(o).data,[3,11];case 10:throw new Error("unknown perspective ".concat(e.perspective));case 11:return[2,{data:c,indicators:n.map((function(t){return t.code})),sectors:r.map((function(t){return t.id})),totals:a.multiplyVector(o)}]}}))}))},e.prototype.getTotalResults=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return Array.isArray(t)?(e={perspective:"final",demand:t},[4,this.calculate(e)]):[3,2];case 1:return[2,i.sent().totals];case 2:return(n=this._totalResults[t])&&n.length>0?[2,n]:[4,this.demand(t)];case 3:return r=i.sent(),[4,this.calculate({perspective:"final",demand:r})];case 4:return(o=i.sent())?(this._totalResults[t]=o.totals,[2,o.totals]):[2,[]]}}))}))},e.prototype.singleRegionSectors=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,c;return i(this,(function(i){switch(i.label){case 0:return this._sectorAggregation?[2,this._sectorAggregation]:[4,this.sectors()];case 1:return t=i.sent(),[4,this.isMultiRegional()];case 2:if(!i.sent())return e=t.reduce((function(t,e){return t[e.code]=e.index,t}),{}),this._sectorAggregation={index:e,sectors:t},[2,this._sectorAggregation];for(n=[],r={},o=0,s=0,a=t;s<a.length;s++)c=a[s],void 0===r[c.code]&&(r[c.code]=o,n[o]={code:c.code,id:c.code,index:o,name:c.name,description:c.description},o++);return this._sectorAggregation={index:r,sectors:n},[2,this._sectorAggregation]}}))}))},e.prototype.sectorCrosswalk=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return this._sectorCrosswalk?[2,this._sectorCrosswalk]:[4,this.api.getText("sectorcrosswalk.csv")];case 1:if(t=i.sent(),0==(e=t.split(/\r?\n/)).length)return[2,{header:[],mappings:[]}];for(n=function(t){var e=t.trim(),n=[];if(0==e.length)return n;for(var r=!1,i="",o=0;o<e.length;o++){var s=e.charAt(o);r?'"'==s?r=!1:i+=s:'"'!=s?","!=s?i+=s:(n.push(i),i=""):r=!0}return n.push(i),n},r=n(e[0]),o=[],s=1;s<e.length;s++)o.push(n(e[s]));return this._sectorCrosswalk={header:r,mappings:o},[2,this._sectorCrosswalk]}}))}))},e}(),v=function(){function e(t,e,n){this.model=t,this.sector=e,this.normalizationTotals=n}return e.of=function(t,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return[4,t.demand(o)];case 1:return r=i.sent(),[4,t.calculate({perspective:"direct",demand:r})];case 2:return s=i.sent(),[2,new e(t,n,s.totals)]}}))}))},e.prototype.getEnvironmentalProfile=function(e){return void 0===e&&(e=!1),r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return[4,e?this.model.column(t.Tensor.D,this.sector.index):this.model.column(t.Tensor.N,this.sector.index)];case 1:for(n=i.sent(),r=0;r<n.length;r++)n[r]/=this.normalizationTotals[r];return[2,n]}}))}))},e.prototype.getImpactsByScope=function(){return r(this,void 0,void 0,(function(){var e,n,r,o,s,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.column(t.Tensor.N,this.sector.index)];case 1:return e=i.sent(),[4,this.model.column(t.Tensor.D,this.sector.index)];case 2:return n=i.sent(),[4,this.model.column(t.Tensor.N_d,this.sector.index)];case 3:for(r=i.sent(),o=l(e.length),s=l(e.length),a=l(e.length),c=0;c<e.length;c++)o[c]=e[c]-n[c],s[c]=r[c]-n[c],a[c]=o[c]-s[c];return[2,{direct:n,total:e,upstreamTotal:o,upstreamDomestic:s,upstreamNonDomestic:a}]}}))}))},e.prototype.getPurchaseImpacts=function(e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,h,f;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.column(t.Tensor.A,this.sector.index)];case 1:return n=i.sent(),Array.isArray(e)?[3,3]:[4,this.model.row(t.Tensor.N,e.index)];case 2:return[2,i.sent().map((function(t,e){return t*n[e]}))];case 3:return r=l(n.length),[4,this.model.matrix(t.Tensor.N)];case 4:for(o=i.sent(),s=0;s<n.length;s++){for(a=new g(this.normalizationTotals),c=n[s],u=0,h=e;u<h.length;u++)f=h[u],a.add(f.index,c*o.get(f.index,s));r[s]=a.finish()}return[2,r]}}))}))},e.prototype.getSupplyChainImpacts=function(e){return r(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,h,f;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.column(t.Tensor.L,this.sector.index)];case 1:return n=i.sent(),Array.isArray(e)?[3,3]:[4,this.model.row(t.Tensor.D,e.index)];case 2:return[2,i.sent().map((function(t,e){return t*n[e]}))];case 3:return r=l(n.length),[4,this.model.matrix(t.Tensor.D)];case 4:for(o=i.sent(),s=0;s<n.length;s++){for(a=new g(this.normalizationTotals),c=n[s],u=0,h=e;u<h.length;u++)f=h[u],a.add(f.index,c*o.get(f.index,s));r[s]=a.finish()}return[2,r]}}))}))},e}(),m=function(t){this.totals=t,this.value=0};!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.add=function(t,e){if(0!==e){var n=this.totals[t];0!==n&&(this.value+=e/n)}},e.prototype.finish=function(){return this.value}}(m);var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.add=function(t,e){if(0!==e){var n=this.totals[t];if(0!==n){var r=Math.pow(e/n,2);e>0?this.value+=r:this.value-=r}}},e.prototype.finish=function(){return this.value>0?Math.sqrt(this.value):0},e}(m);t.CommodityVector=h,t.DemandVector=u,t.Matrix=s,t.NaicsMap=f,t.SectorAnalysis=v,t.WebApi=d,t.WebModel=p,t.max=function(t){return t&&0!==t.length?t.reduce((function(t,e){return Math.max(t,e)})):0},t.modelOf=function(t){var e=new d(t);return new p(e,t.model)},t.ones=function(t){return new Array(t).fill(1)},t.zeros=l,Object.defineProperty(t,"__esModule",{value:!0})}));